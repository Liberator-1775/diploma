(()=>{"use strict";var e;!function(e){e[e.voiceRequest=0]="voiceRequest",e[e.voiceResponse=1]="voiceResponse"}(e||(e={})),chrome.runtime.onMessage.addListener((function(t,o,n){return t.action===e.voiceRequest&&chrome.storage.local.get(["googleApiKey","deeplApiKey","targetLanguage","voiceName","translationEnabled","speakingRate"]).then((o=>{o.translationEnabled?fetch("https://api.deepl.com/v2/translate",{method:"POST",headers:{Authorization:`DeepL-Auth-Key ${o.deeplApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({text:[t.content],target_lang:o.targetLanguage})}).then((t=>{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);t.json().then((t=>{fetch("https://texttospeech.googleapis.com/v1/text:synthesize?key="+o.googleApiKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:t.translations[0].text},voice:{languageCode:o.targetLanguage,name:o.voiceName},audioConfig:{audioEncoding:"MP3"}})}).then((t=>{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);t.json().then((t=>{chrome.tabs.query({active:!0,currentWindow:!0},(o=>{var n;o.length>0&&void 0!==(null===(n=o[0])||void 0===n?void 0:n.id)&&chrome.tabs.sendMessage(o[0].id,{action:e.voiceResponse,content:t.audioContent}).catch((e=>{console.error("Error sending message: ",e)}))}))})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)})):fetch("https://texttospeech.googleapis.com/v1/text:synthesize?key="+o.googleApiKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:t.content},voice:{languageCode:"ru-RU",name:"ru-RU-Wavenet-A"},audioConfig:{audioEncoding:"MP3"}})}).then((t=>{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);t.json().then((t=>{chrome.tabs.query({active:!0,currentWindow:!0},(o=>{var n;o.length>0&&void 0!==(null===(n=o[0])||void 0===n?void 0:n.id)&&chrome.tabs.sendMessage(o[0].id,{action:e.voiceResponse,content:t.audioContent}).catch((e=>{console.error("Error sending message: ",e)}))}))})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)})),!0}))})();